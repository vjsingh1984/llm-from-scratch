<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 700">
  <!-- Title -->
  <text x="425" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    Training Loop: How the Model Learns
  </text>
  <text x="425" y="55" font-size="14" text-anchor="middle" fill="#666">
    Iterative process of improving predictions
  </text>

  <!-- Epoch indicator -->
  <rect x="50" y="80" width="750" height="50" fill="#FFECB3" stroke="#FFA000" stroke-width="2" rx="8"/>
  <text x="425" y="112" font-size="16" font-weight="bold" text-anchor="middle" fill="#FF6F00">
    üîÑ One Epoch = Process all training data once
  </text>

  <!-- Main training loop -->
  <rect x="30" y="150" width="790" height="490" fill="#F5F5F5" stroke="#666" stroke-width="3" rx="10" stroke-dasharray="10,5"/>

  <!-- Step 1: Load batch -->
  <g id="load-batch">
    <rect x="60" y="180" width="730" height="80" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="8"/>
    <text x="425" y="205" font-size="15" font-weight="bold" text-anchor="middle" fill="#0D47A1">
      Step 1: Load Batch of Data
    </text>
    <text x="75" y="230" font-size="12" fill="#666">
      Take a small chunk (e.g., 16 examples) from training data
    </text>
    <rect x="75" y="240" width="700" height="30" fill="#BBDEFB" stroke="#1976D2" rx="5"/>
    <text x="425" y="260" font-size="11" text-anchor="middle" font-family="monospace" fill="#333">
      Input: ["#!/bin/bash...", "tar -czf...", ...] (16 scripts)
    </text>
  </g>

  <!-- Arrow -->
  <path d="M 425 265 L 425 285" stroke="#1976D2" stroke-width="3" fill="none" marker-end="url(#arrowblue)"/>

  <!-- Step 2: Forward pass -->
  <g id="forward">
    <rect x="60" y="290" width="730" height="90" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" rx="8"/>
    <text x="425" y="315" font-size="15" font-weight="bold" text-anchor="middle" fill="#E65100">
      Step 2: Forward Pass (Make Predictions)
    </text>
    <text x="75" y="340" font-size="12" fill="#666">
      Model processes input and predicts next tokens
    </text>
    <rect x="75" y="350" width="330" height="25" fill="#FFE0B2" stroke="#FF9800" rx="5"/>
    <text x="240" y="367" font-size="11" text-anchor="middle" fill="#333">
      Actual next token: "bash"
    </text>
    <rect x="445" y="350" width="330" height="25" fill="#FFCC80" stroke="#FF9800" rx="5"/>
    <text x="610" y="367" font-size="11" text-anchor="middle" fill="#333">
      Model prediction: "bash" (70% confidence)
    </text>
  </g>

  <!-- Arrow -->
  <path d="M 425 385 L 425 405" stroke="#FF9800" stroke-width="3" fill="none" marker-end="url(#arroworange)"/>

  <!-- Step 3: Calculate loss -->
  <g id="loss">
    <rect x="60" y="410" width="730" height="80" fill="#FFEBEE" stroke="#D32F2F" stroke-width="2" rx="8"/>
    <text x="425" y="435" font-size="15" font-weight="bold" text-anchor="middle" fill="#B71C1C">
      Step 3: Calculate Loss (How Wrong Are We?)
    </text>
    <text x="75" y="460" font-size="12" fill="#666">
      Compare predictions vs. actual ‚Üí Loss = measure of error
    </text>
    <rect x="75" y="467" width="700" height="20" fill="#EF9A9A" stroke="#D32F2F" rx="5"/>
    <text x="425" y="482" font-size="11" text-anchor="middle" font-weight="bold" fill="#B71C1C">
      Loss = 2.35 (Lower is better!)
    </text>
  </g>

  <!-- Arrow -->
  <path d="M 425 495 L 425 515" stroke="#D32F2F" stroke-width="3" fill="none" marker-end="url(#arrowred)"/>

  <!-- Step 4: Backpropagation -->
  <g id="backward">
    <rect x="60" y="520" width="730" height="70" fill="#E8EAF6" stroke="#3F51B5" stroke-width="2" rx="8"/>
    <text x="425" y="545" font-size="15" font-weight="bold" text-anchor="middle" fill="#1A237E">
      Step 4: Backpropagation (Calculate Gradients)
    </text>
    <text x="75" y="568" font-size="12" fill="#666">
      Determine which model parameters to adjust and by how much
    </text>
    <text x="75" y="583" font-size="11" fill="#999" font-style="italic">
      Gradients flow backwards through all 48.7M parameters
    </text>
  </g>

  <!-- Arrow -->
  <path d="M 425 595 L 425 610" stroke="#3F51B5" stroke-width="3" fill="none" marker-end="url(#arrowindigo)"/>

  <!-- Step 5: Update weights -->
  <g id="update">
    <rect x="60" y="615" width="730" height="55" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2" rx="8"/>
    <text x="425" y="640" font-size="15" font-weight="bold" text-anchor="middle" fill="#1B5E20">
      Step 5: Update Model Parameters (Learn!)
    </text>
    <text x="425" y="660" font-size="12" text-anchor="middle" fill="#666">
      Adjust weights using optimizer (AdamW) ‚Üí Model gets slightly better
    </text>
  </g>

  <!-- Loop back arrow -->
  <path d="M 60 550 L 25 550 L 25 200 L 60 200" stroke="#666" stroke-width="3" fill="none" marker-end="url(#arrowgray)" stroke-dasharray="5,3"/>
  <text x="15" y="370" font-size="12" fill="#666" font-weight="bold" writing-mode="tb">
    ‚Üª REPEAT
  </text>

  <!-- Bottom summary -->
  <rect x="50" y="675" width="750" height="25" fill="#E1F5FE" stroke="#0288D1" stroke-width="2" rx="5"/>
  <text x="425" y="693" font-size="13" text-anchor="middle" fill="#01579B" font-weight="bold">
    After many epochs: Loss ‚Üì (4.0 ‚Üí 2.3 ‚Üí 1.0) = Model learns to generate code!
  </text>

  <!-- Side info panel -->
  <g id="info-panel">
    <rect x="600" y="80" width="190" height="60" fill="#FFF9C4" stroke="#F9A825" stroke-width="2" rx="5"/>
    <text x="695" y="100" font-size="12" font-weight="bold" text-anchor="middle" fill="#F57F17">
      ‚öôÔ∏è Training Settings
    </text>
    <text x="610" y="118" font-size="10" fill="#666">
      ‚Ä¢ Batch size: 16
    </text>
    <text x="610" y="132" font-size="10" fill="#666">
      ‚Ä¢ Learning rate: 3e-4
    </text>
  </g>

  <!-- Loss visualization -->
  <g id="loss-viz">
    <text x="695" y="165" font-size="11" font-weight="bold" text-anchor="middle" fill="#D32F2F">
      üìâ Loss Over Time
    </text>

    <!-- Simple line graph -->
    <polyline points="610,210 630,200 650,185 670,175 690,168 710,163 730,160 750,158"
              fill="none" stroke="#D32F2F" stroke-width="2"/>

    <!-- Axis -->
    <line x1="610" y1="210" x2="750" y2="210" stroke="#999" stroke-width="1"/>
    <line x1="610" y1="160" x2="610" y2="210" stroke="#999" stroke-width="1"/>

    <!-- Labels -->
    <text x="605" y="165" font-size="8" text-anchor="end" fill="#666">4.0</text>
    <text x="605" y="210" font-size="8" text-anchor="end" fill="#666">1.0</text>
    <text x="675" y="225" font-size="8" text-anchor="middle" fill="#666">Epochs ‚Üí</text>
  </g>

  <!-- Key concepts box -->
  <g id="concepts">
    <rect x="60" y="80" width="200" height="60" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2" rx="5"/>
    <text x="160" y="100" font-size="12" font-weight="bold" text-anchor="middle" fill="#1B5E20">
      üí° Key Concept
    </text>
    <text x="70" y="118" font-size="10" fill="#666">
      Model learns by:
    </text>
    <text x="70" y="132" font-size="9" fill="#666">
      Making predictions ‚Üí Getting feedback ‚Üí Improving
    </text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1976D2" />
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FF9800" />
    </marker>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#D32F2F" />
    </marker>
    <marker id="arrowindigo" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3F51B5" />
    </marker>
    <marker id="arrowgray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666" />
    </marker>
  </defs>
</svg>
