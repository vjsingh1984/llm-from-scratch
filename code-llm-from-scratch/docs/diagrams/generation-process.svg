<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 750">
  <!-- Arrow markers - must be defined first -->
  <defs>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4CAF50" />
    </marker>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#1976D2" />
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FF9800" />
    </marker>
    <marker id="arrowpurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#7B1FA2" />
    </marker>
    <marker id="arrowblack" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="750" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="450" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#333" font-family="Arial, sans-serif">
    Code Generation Process
  </text>
  <text x="450" y="55" font-size="14" text-anchor="middle" fill="#666" font-family="Arial, sans-serif">
    How the model creates code one token at a time (autoregressive generation)
  </text>

  <!-- Initial prompt -->
  <g id="prompt">
    <rect x="50" y="90" width="800" height="70" fill="#E8F5E9" stroke="#4CAF50" stroke-width="3" rx="10"/>
    <text x="450" y="115" font-size="16" font-weight="bold" text-anchor="middle" fill="#1B5E20" font-family="Arial, sans-serif">
      Step 0: User Provides Prompt
    </text>
    <text x="450" y="140" font-size="14" text-anchor="middle" fill="#333" font-family="Courier New, monospace">
      "#!/bin/bash  # Create a backup script"
    </text>
  </g>

  <!-- Arrow -->
  <path d="M 450 165 L 450 195" stroke="#4CAF50" stroke-width="3" fill="none" marker-end="url(#arrowgreen)"/>

  <!-- Generation loop box -->
  <rect x="30" y="200" width="840" height="480" fill="#F5F5F5" stroke="#666" stroke-width="2" rx="10" stroke-dasharray="10,5"/>
  <text x="450" y="230" font-size="16" font-weight="bold" text-anchor="middle" fill="#333" font-family="Arial, sans-serif">
    Generation Loop (Repeat until complete)
  </text>

  <!-- Step 1: Encode -->
  <g id="step1">
    <rect x="60" y="250" width="350" height="100" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="8"/>
    <text x="235" y="275" font-size="14" font-weight="bold" text-anchor="middle" fill="#0D47A1" font-family="Arial, sans-serif">
      Step 1: Tokenize Current Text
    </text>
    <text x="75" y="300" font-size="12" fill="#666" font-family="Arial, sans-serif">
      Convert text to token IDs
    </text>
    <rect x="75" y="310" width="310" height="30" fill="#BBDEFB" stroke="#1976D2" rx="5"/>
    <text x="230" y="330" font-size="11" text-anchor="middle" fill="#333" font-family="Courier New, monospace">
      "#!/bin/bash" -&gt; [1234, 5678, 9012]
    </text>
  </g>

  <!-- Step 2: Model forward pass -->
  <g id="step2">
    <rect x="450" y="250" width="390" height="100" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" rx="8"/>
    <text x="645" y="275" font-size="14" font-weight="bold" text-anchor="middle" fill="#E65100" font-family="Arial, sans-serif">
      Step 2: Model Prediction
    </text>
    <text x="465" y="300" font-size="12" fill="#666" font-family="Arial, sans-serif">
      Run through transformer, get probabilities
    </text>
    <rect x="465" y="310" width="360" height="30" fill="#FFE0B2" stroke="#FF9800" rx="5"/>
    <text x="645" y="330" font-size="11" text-anchor="middle" fill="#333" font-family="Courier New, monospace">
      Probs: ["tar"=35%, "echo"=20%, "cd"=15%]
    </text>
  </g>

  <!-- Arrow down -->
  <path d="M 235 355 L 235 375" stroke="#1976D2" stroke-width="2" fill="none" marker-end="url(#arrowblue)"/>
  <path d="M 645 355 L 645 375" stroke="#FF9800" stroke-width="2" fill="none" marker-end="url(#arroworange)"/>

  <!-- Step 3: Sample next token -->
  <g id="step3">
    <rect x="60" y="380" width="780" height="110" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" rx="8"/>
    <text x="450" y="405" font-size="14" font-weight="bold" text-anchor="middle" fill="#4A148C" font-family="Arial, sans-serif">
      Step 3: Sample Next Token
    </text>
    <text x="75" y="430" font-size="12" fill="#666" font-family="Arial, sans-serif">
      Use temperature and top-k/top-p to choose next token
    </text>

    <!-- Sampling methods -->
    <g id="sampling">
      <rect x="75" y="440" width="240" height="40" fill="#E1BEE7" stroke="#7B1FA2" rx="5"/>
      <text x="195" y="465" font-size="11" text-anchor="middle" fill="#333" font-family="Arial, sans-serif">
        Temperature=0.8, Top-k=50
      </text>

      <text x="340" y="465" font-size="16" text-anchor="middle" fill="#4A148C" font-weight="bold" font-family="Arial, sans-serif">
        -&gt;
      </text>

      <rect x="370" y="440" width="180" height="40" fill="#CE93D8" stroke="#7B1FA2" rx="5"/>
      <text x="460" y="465" font-size="12" text-anchor="middle" fill="#fff" font-weight="bold" font-family="Arial, sans-serif">
        Selected: "tar"
      </text>

      <text x="575" y="465" font-size="16" text-anchor="middle" fill="#4A148C" font-weight="bold" font-family="Arial, sans-serif">
        -&gt;
      </text>

      <rect x="600" y="440" width="220" height="40" fill="#BA68C8" stroke="#7B1FA2" rx="5"/>
      <text x="710" y="465" font-size="11" text-anchor="middle" fill="#fff" font-weight="bold" font-family="Arial, sans-serif">
        Add to sequence
      </text>
    </g>
  </g>

  <!-- Arrow down -->
  <path d="M 450 495 L 450 515" stroke="#7B1FA2" stroke-width="3" fill="none" marker-end="url(#arrowpurple)"/>

  <!-- Step 4: Update and repeat -->
  <g id="step4">
    <rect x="60" y="520" width="780" height="90" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2" rx="8"/>
    <text x="450" y="545" font-size="14" font-weight="bold" text-anchor="middle" fill="#1B5E20" font-family="Arial, sans-serif">
      Step 4: Update Text and Repeat
    </text>
    <rect x="75" y="555" width="750" height="45" fill="#A5D6A7" stroke="#4CAF50" rx="5"/>
    <text x="450" y="573" font-size="12" text-anchor="middle" fill="#333" font-family="Courier New, monospace">
      Updated: "#!/bin/bash  # Create a backup script  tar"
    </text>
    <text x="450" y="593" font-size="11" text-anchor="middle" fill="#1B5E20" font-weight="bold" font-family="Arial, sans-serif">
      Go back to Step 1 until max_length reached or stop token
    </text>
  </g>

  <!-- End of loop -->
  <text x="450" y="645" font-size="13" text-anchor="middle" fill="#666" font-style="italic" font-family="Arial, sans-serif">
    Loop continues: tar -&gt; -czf -&gt; backup.tar.gz -&gt; ...
  </text>

  <!-- Arrow down from loop -->
  <path d="M 450 660 L 450 680" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowblack)"/>

  <!-- Final output -->
  <g id="output">
    <rect x="50" y="690" width="800" height="45" fill="#FFD54F" stroke="#F9A825" stroke-width="3" rx="8"/>
    <text x="450" y="718" font-size="14" font-weight="bold" text-anchor="middle" fill="#F57F17" font-family="Arial, sans-serif">
      Final Generated Code!
    </text>
  </g>

  <!-- Side panel with generation parameters -->
  <g id="params">
    <rect x="620" y="70" width="220" height="120" fill="#FFF9C4" stroke="#F9A825" stroke-width="2" rx="5"/>
    <text x="730" y="95" font-size="13" font-weight="bold" text-anchor="middle" fill="#F57F17" font-family="Arial, sans-serif">
      Generation Settings
    </text>
    <text x="635" y="118" font-size="11" fill="#666" font-family="Arial, sans-serif">
      Max Length: 200 tokens
    </text>
    <text x="635" y="136" font-size="11" fill="#666" font-family="Arial, sans-serif">
      Temperature: 0.8
    </text>
    <text x="645" y="151" font-size="9" fill="#999" font-family="Arial, sans-serif">
      (Lower = focused, Higher = creative)
    </text>
    <text x="635" y="170" font-size="11" fill="#666" font-family="Arial, sans-serif">
      Top-k: 50 tokens
    </text>
    <text x="645" y="185" font-size="9" fill="#999" font-family="Arial, sans-serif">
      (Consider top 50 options)
    </text>
  </g>
</svg>
