<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 500">
  <defs>
    <linearGradient id="qGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="kGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <linearGradient id="vGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ee0979"/>
      <stop offset="100%" style="stop-color:#ff6a00"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="500" fill="#f8fafc"/>

  <!-- Title -->
  <text x="350" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1e293b">Self-Attention Mechanism</text>
  <text x="350" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#64748b">How tokens attend to each other</text>

  <!-- Input -->
  <g transform="translate(275, 75)">
    <rect width="150" height="35" rx="6" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
    <text x="75" y="23" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="#475569">Input Embedding</text>
  </g>

  <!-- Arrows to Q, K, V -->
  <path d="M350 110 L350 130 L200 130 L200 150" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M350 110 L350 150" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M350 110 L350 130 L500 130 L500 150" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Q, K, V Projections -->
  <g transform="translate(125, 155)">
    <rect width="150" height="50" rx="8" fill="url(#qGrad)" filter="url(#shadow)"/>
    <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">Query (Q)</text>
    <text x="75" y="42" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)">W_q × Input</text>
  </g>

  <g transform="translate(275, 155)">
    <rect width="150" height="50" rx="8" fill="url(#kGrad)" filter="url(#shadow)"/>
    <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">Key (K)</text>
    <text x="75" y="42" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)">W_k × Input</text>
  </g>

  <g transform="translate(425, 155)">
    <rect width="150" height="50" rx="8" fill="url(#vGrad)" filter="url(#shadow)"/>
    <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">Value (V)</text>
    <text x="75" y="42" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)">W_v × Input</text>
  </g>

  <!-- Arrows from Q, K -->
  <path d="M200 205 L200 240" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M350 205 L350 240" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- MatMul Q×K^T -->
  <g transform="translate(175, 250)">
    <rect width="200" height="45" rx="8" fill="#1e293b" filter="url(#shadow)"/>
    <text x="100" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white">Q × K^T / √d_k</text>
  </g>

  <!-- Arrow to Softmax -->
  <path d="M275 295 L275 320" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Softmax -->
  <g transform="translate(175, 325)">
    <rect width="200" height="40" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="100" y="26" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#92400e">Softmax</text>
  </g>

  <!-- Attention weights visualization -->
  <g transform="translate(400, 250)">
    <text x="75" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#475569">Attention Matrix</text>
    <rect x="0" y="10" width="150" height="100" rx="4" fill="#f1f5f9" stroke="#cbd5e1"/>
    <!-- Heatmap cells -->
    <rect x="10" y="20" width="30" height="20" fill="#667eea" opacity="0.9"/>
    <rect x="45" y="20" width="30" height="20" fill="#667eea" opacity="0.3"/>
    <rect x="80" y="20" width="30" height="20" fill="#667eea" opacity="0.1"/>
    <rect x="115" y="20" width="25" height="20" fill="#667eea" opacity="0.05"/>

    <rect x="10" y="45" width="30" height="20" fill="#667eea" opacity="0.2"/>
    <rect x="45" y="45" width="30" height="20" fill="#667eea" opacity="0.8"/>
    <rect x="80" y="45" width="30" height="20" fill="#667eea" opacity="0.4"/>
    <rect x="115" y="45" width="25" height="20" fill="#667eea" opacity="0.1"/>

    <rect x="10" y="70" width="30" height="20" fill="#667eea" opacity="0.1"/>
    <rect x="45" y="70" width="30" height="20" fill="#667eea" opacity="0.3"/>
    <rect x="80" y="70" width="30" height="20" fill="#667eea" opacity="0.7"/>
    <rect x="115" y="70" width="25" height="20" fill="#667eea" opacity="0.5"/>

    <text x="75" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">Darker = more attention</text>
  </g>

  <!-- Arrow to MatMul with V -->
  <path d="M275 365 L275 385" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M500 205 L500 390 L395 390" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- MatMul with V -->
  <g transform="translate(175, 390)">
    <rect width="200" height="45" rx="8" fill="#1e293b" filter="url(#shadow)"/>
    <text x="100" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white">Attention × V</text>
  </g>

  <!-- Arrow to Output -->
  <path d="M275 435 L275 455" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Output -->
  <g transform="translate(200, 460)">
    <rect width="150" height="30" rx="6" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
    <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="#475569">Output</text>
  </g>

  <!-- Formula -->
  <g transform="translate(520, 420)">
    <rect x="0" y="0" width="160" height="60" rx="6" fill="#f1f5f9" stroke="#e2e8f0"/>
    <text x="80" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#475569">Formula:</text>
    <text x="80" y="40" text-anchor="middle" font-family="monospace" font-size="10" fill="#1e293b">Attention(Q,K,V) =</text>
    <text x="80" y="52" text-anchor="middle" font-family="monospace" font-size="10" fill="#1e293b">softmax(QK^T/√d)V</text>
  </g>
</svg>
